import "./App.css";
import editModal, { editMatch } from "./components/editModal.jsx";
import form, { add } from "./components/form.jsx";
import { generateMatches } from "./components/matches.jsx";
import { useNavigate } from "react-router-dom";
import { useEffect, useState } from "react";

async function onLogout(event, navigate) {
  const response = await fetch('/logout', {
    method: 'GET',
  });
  if (response.ok) {
    navigate('/'); // Redirect to the root URL
  } else {
    console.error('Logout failed');
  }
}

export default function Dashboard() {
  const navigate = useNavigate();
  const [matches, setMatches] = useState([]);

  useEffect(() => {
    const fetchMatches = async () => {
      const newMatches = await generateMatches();
      setMatches(newMatches);
    };

    fetchMatches();

    const closeModal = () => {
      document.getElementById('editModal').style.display = 'none';
    };

    document.querySelector('.modal-close').addEventListener('click', closeModal);
    document.querySelector('.cancel-modal').addEventListener('click', closeModal);

    // Cleanup event listeners on unmount
    return () => {
      document.querySelector('.modal-close').removeEventListener('click', closeModal);
      document.querySelector('.cancel-modal').removeEventListener('click', closeModal);
    };
  }, []);

  return (
    <>
      <h1 className="title is-family-primary is-size-1 pt-6 is-flex is-flex-direction-row">
        Submit your Match!
        <button id="logoutButton" className="button is-info" onClick={(e) => onLogout(e, navigate)}>Logout</button>
      </h1>
      <div>
        {form()}
        <div id="matches-container">
          {matches.map((match, index) => (
            <div key={index}>{match}</div>
          ))}
        </div>
        {editModal()}
      </div>
    </>
  );
}